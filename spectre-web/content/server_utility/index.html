<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Server Utility — Spectre</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header class="toolbar">
    <div class="toolbar-heading">
      <h1 class="toolbar-title">Server Utility</h1>
      <p class="toolbar-subtitle">Powered by Spectre</p>
    </div>
    <span class="toolbar-save-row">
      <span class="unsaved-indicator" id="unsaved-indicator" aria-label="Unsaved changes" title="Unsaved changes">
      <span class="unsaved-dot"></span>
      <span class="unsaved-label-container">
        <span class="unsaved-label">Unsaved</span>
      </span>
    </span>
      <button type="button" class="btn btn-primary" id="save-config">Save</button>
    </span>
  </header>
  <div class="message-banner" id="message-banner" role="status" aria-live="polite"></div>

  <div class="main">
    <aside class="sidebar">
      <section class="sidebar-section" id="server-section">
        <div class="server-status-wrap">
          <div class="server-status" id="server-status" aria-live="polite">
            <span class="server-status-dot" id="server-status-dot"></span>
            <span class="server-status-text" id="server-status-text">Stopped</span>
            <span class="server-status-players" id="server-status-players" aria-label="Players">-- / --</span>
          </div>
        </div>
        <label class="sidebar-label">Server</label>
        <select class="select" id="server-select" aria-label="Select server"></select>
        <div class="server-section-actions">
          <button type="button" class="btn btn-sm" id="server-add">Add</button>
          <button type="button" class="btn btn-sm" id="edit-server">Edit</button>
          <button type="button" class="btn btn-sm btn-stop" id="server-delete" title="Delete this server">Delete</button>
        </div>
      </section>

      <section class="sidebar-section">
        <label class="sidebar-label">Profiles</label>
        <div class="profile-list" id="profile-list" role="listbox" aria-label="Config profiles"></div>
        <div class="sidebar-actions">
          <button type="button" class="btn btn-sm" id="profile-new">New</button>
          <button type="button" class="btn btn-sm" id="profile-delete">Delete</button>
          <button type="button" class="btn btn-sm" id="profile-duplicate">Duplicate</button>
          <button type="button" class="btn btn-sm" id="profile-select">Select</button>
        </div>
      </section>

      <section class="sidebar-section">
        <label class="sidebar-label">Game</label>
        <select class="select" id="game-select" aria-label="Game executable">
          <option value="hd2">Hidden &amp; Dangerous 2</option>
          <option value="sabre">H&amp;D2: Sabre Squadron</option>
        </select>
      </section>

      <div class="sidebar-spacer"></div>
      <button type="button" class="btn btn-start" id="start-server">Start Server</button>
      <button type="button" class="btn btn-sm" id="start-all-servers">Start All Servers</button>
      <div class="sidebar-version">Spectre {{SPECTRE_VERSION}}</div>
    </aside>

    <main class="content">
      <div class="tabs" role="tablist">
        <button type="button" class="tab" data-tab="console" role="tab" aria-selected="true">Console</button>
        <button type="button" class="tab" data-tab="players" role="tab">Players</button>
        <button type="button" class="tab" data-tab="logs" role="tab">Logs</button>
        <span class="tab-sep" aria-hidden="true"></span>
        <button type="button" class="tab" data-tab="maps" role="tab">General</button>
        <button type="button" class="tab" data-tab="coop" role="tab">Coop</button>
        <button type="button" class="tab" data-tab="general" role="tab">Settings</button>
      </div>

      <div class="tab-panels">
        <section class="tab-panel" id="panel-console" role="tabpanel">
          <div class="panel-card">
            <p class="form-notice form-notice-info">Coming soon!</p>
          </div>
        </section>
        <section class="tab-panel hidden" id="panel-maps" role="tabpanel">
          <div class="panel-card">
            <h2 class="panel-heading">Session &amp; game</h2>
            <div class="form-row">
              <label>Profile name</label>
              <input type="text" class="input" id="profile-name" placeholder="Profile name">
            </div>
            <div class="form-row">
              <label>Session name (shown in-game)</label>
              <input type="text" class="input" id="session-name" placeholder="A Spectre Session">
            </div>
            <div class="form-row">
              <label>Style</label>
              <select class="select" id="style-select">
                <option value="Deathmatch">Deathmatch</option>
                <option value="Occupation">Occupation</option>
                <option value="Objectives">Objectives</option>
                <option value="Cooperative">Coop</option>
              </select>
            </div>
            <div class="form-row">
              <label>Domain</label>
              <div class="radio-group" role="radiogroup" aria-label="Domain type">
                <label class="radio-label">
                  <input type="radio" name="domain-type" value="local" id="domain-local" checked>
                  Local
                </label>
                <label class="radio-label">
                  <input type="radio" name="domain-type" value="Internet" id="domain-internet">
                  Internet
                </label>
              </div>
            </div>
          </div>
          <div class="panel-card">
            <h2 class="panel-heading">Map rotation</h2>
            <div class="form-row form-row-with-button">
              <label for="mpmaplist-path">Maplist path (mpmaplist.txt) — per profile</label>
              <div class="input-with-icon">
                <input type="text" class="input" id="mpmaplist-path" placeholder="Path to mpmaplist.txt">
                <button type="button" class="btn btn-icon" id="mpmaplist-clear" title="Clear maplist path">
                  <span class="btn-icon-label">Clear</span>
                </button>
              </div>
            </div>
            <p class="map-hint">Maps come from this server's <code>mpmaplist.txt</code>. Enter the path to mpmaplist.txt and save to persist; maps load when you set the path. Add maps from the available list into the rotation.</p>
            <div class="map-lists-row">
              <div class="map-list-box">
                <label class="map-list-label">Available</label>
                <ul class="map-list" id="available-map-list" role="listbox" aria-label="Available maps"></ul>
              </div>
              <div class="map-list-actions">
                <button type="button" class="btn btn-sm" id="map-add" title="Add selected map to rotation">Add →</button>
                <button type="button" class="btn btn-sm" id="map-remove" title="Remove from rotation">← Remove</button>
                <div class="map-add-random-row">
                  <input type="number" class="input input-num" id="map-add-random-count" min="1" value="1" aria-label="Number of maps to add randomly">
                  <button type="button" class="btn btn-sm" id="map-add-random" title="Add this many random maps from available to rotation">Add Random Maps</button>
                </div>
              </div>
              <div class="map-list-box">
                <label class="map-list-label">Rotation</label>
                <div class="map-rotation-toolbar">
                  <button type="button" class="btn btn-sm" id="map-shuffle" title="Randomize order of maps in rotation">Shuffle List</button>
                  <button type="button" class="btn btn-sm" id="map-sort" title="Sort rotation alphabetically">Sort List</button>
                  <button type="button" class="btn btn-sm btn-stop" id="map-remove-all" title="Remove all maps from rotation">Remove All</button>
                </div>
                <div class="map-list-with-order">
                  <ul class="map-list" id="map-list" role="listbox" aria-label="Map rotation"></ul>
                  <div class="map-order-buttons" aria-label="Reorder rotation">
                    <button type="button" class="btn btn-icon" id="map-up" title="Move up">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M18 15l-6-6-6 6"/></svg>
                    </button>
                    <button type="button" class="btn btn-icon" id="map-down" title="Move down">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 9l6 6 6-6"/></svg>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="tab-panel hidden" id="panel-general" role="tabpanel">
          <div class="panel-card">
            <h2 class="panel-heading">Settings</h2>
            <div class="form-grid">
              <div class="form-row">
                <label>Max clients</label>
                <input type="number" class="input input-num" id="max-clients" min="1" max="32" value="32">
              </div>
              <div class="form-row">
                <label>Point limit</label>
                <input type="number" class="input input-num" id="point-limit" min="0" value="0">
              </div>
              <div class="form-row">
                <label>Round limit</label>
                <input type="number" class="input input-num" id="round-limit" min="0" value="5">
              </div>
              <div class="form-row">
                <label>Round count</label>
                <input type="number" class="input input-num" id="round-count" min="1" max="20" value="3">
              </div>
              <div class="form-row">
                <label>Respawn time (s)</label>
                <input type="number" class="input input-num" id="respawn-time" min="0" value="3">
              </div>
              <div class="form-row">
                <label>Spawn protection (s)</label>
                <input type="number" class="input input-num" id="spawn-protection" min="0" max="30" value="5">
              </div>
              <div class="form-row">
                <label>Warmup (s)</label>
                <input type="number" class="input input-num" id="warmup" min="0" max="60" value="10">
              </div>
              <div class="form-row">
                <label>Inverse damage (%)</label>
                <input type="number" class="input input-num" id="inverse-damage" min="0" max="200" value="100">
              </div>
              <div class="form-row">
                <label class="checkbox-label">
                  <input type="checkbox" id="friendly-fire" checked> Friendly fire
                </label>
              </div>
              <div class="form-row">
                <label class="checkbox-label">
                  <input type="checkbox" id="auto-team-balance" checked> Auto team balance
                </label>
              </div>
              <div class="form-row">
                <label class="checkbox-label">
                  <input type="checkbox" id="third-person-view"> Allow 3rd person view
                </label>
              </div>
              <div class="form-row">
                <label class="checkbox-label">
                  <input type="checkbox" id="allow-crosshair" checked> Allow crosshair
                </label>
              </div>
              <div class="form-row">
                <label class="checkbox-label">
                  <input type="checkbox" id="falling-dmg" checked> Falling damage
                </label>
              </div>
              <div class="form-row">
                <label class="checkbox-label">
                  <input type="checkbox" id="allow-respawn"> Allow respawn
                </label>
              </div>
              <div class="form-row">
                <label class="checkbox-label">
                  <input type="checkbox" id="allow-vehicles" checked> Allow vehicles
                </label>
              </div>
            </div>
          </div>
          <div class="panel-advanced-section">
            <div class="panel-card">
              <h2 class="panel-heading">Advanced</h2>
              <div class="form-grid">
                <div class="form-row">
                  <label>Password</label>
                  <input type="password" class="input" id="password" placeholder="Server password">
                </div>
                <div class="form-row">
                  <label>Admin password</label>
                  <input type="password" class="input" id="admin-pass" placeholder="Admin password">
                </div>
                <div class="form-row">
                  <label>Max ping</label>
                  <input type="number" class="input input-num" id="max-ping" min="0" value="0">
                </div>
                <div class="form-row">
                  <label>Max frequency</label>
                  <input type="number" class="input input-num" id="max-freq" min="0" value="50">
                </div>
                <div class="form-row">
                  <label>Max inactivity (s)</label>
                  <input type="number" class="input input-num" id="max-inactivity" min="0" value="0">
                </div>
                <div class="form-row form-row-with-notice">
                  <p class="form-notice form-notice-info">Not in use</p>
                  <label>Voice chat</label>
                  <select class="select" id="voice-chat" disabled aria-label="Voice chat (not in use)">
                    <option value="0" selected>Not used</option>
                    <option value="1">Codec 1.2 kbps</option>
                    <option value="2">Codec 3.2 kbps</option>
                    <option value="3">Codec 6.4 kbps</option>
                    <option value="4">Codec 8.0 kbps</option>
                    <option value="5">Codec 13.0 kbps</option>
                    <option value="6">Codec 32.0 kbps</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="panel-card">
              <h2 class="panel-heading">Watchdog</h2>
              <p class="map-hint">Restart crashed servers automatically. Optionally restart all servers every N days (e.g. 16). Requires Spectre to be running.</p>
              <p class="form-notice form-notice-info form-notice-full">0 = no timed restart. When &gt; 0, all servers are stopped and started again after this many days.</p>
              <div class="form-grid">
                <div class="form-row form-row-full">
                  <label class="checkbox-label">
                    <input type="checkbox" id="watchdog-restart-on-crash" checked> Restart on crash
                  </label>
                </div>
                <div class="form-row">
                  <label for="watchdog-restart-days">Restart all every (days)</label>
                  <input type="number" class="input input-num" id="watchdog-restart-days" min="0" max="365" value="0" aria-label="Restart interval in days, 0 = off">
                </div>
                <div class="form-row">
                  <label for="log-rotation-days">Rotate logs after (days)</label>
                  <input type="number" class="input input-num" id="log-rotation-days" min="0" max="365" value="0" aria-label="Clear log file after this many days, 0 = no rotation">
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="tab-panel hidden" id="panel-coop" role="tabpanel">
          <div class="panel-card">
            <h2 class="panel-heading">Coop</h2>
            <div class="form-grid">
              <div class="form-row">
                <label>Difficulty</label>
                <select class="select" id="difficulty">
                  <option value="Easy">Easy</option>
                  <option value="Normal">Normal</option>
                  <option value="Hard" selected>Hard</option>
                  <option value="Very hard">Very hard</option>
                </select>
              </div>
              <div class="form-row">
                <label>Respawn number (0 = no limit)</label>
                <input type="number" class="input input-num" id="respawn-number" min="0" max="99" value="0">
              </div>
              <div class="form-row form-row-full">
                <label class="checkbox-label">
                  <input type="checkbox" id="team-respawn" checked> Team respawn
                </label>
              </div>
            </div>
          </div>
        </section>

        <section class="tab-panel hidden" id="panel-players" role="tabpanel">
          <div class="panel-card">
            <h2 class="panel-heading">Current players</h2>
            <p class="map-hint">Players currently in the selected server. Click an IP to reveal it.</p>
            <div class="players-table-wrap">
              <table class="players-table" id="current-players-table" aria-label="Current players">
                <thead>
                  <tr>
                    <th scope="col">Name</th>
                    <th scope="col">IP</th>
                    <th scope="col" class="col-ban">Ban</th>
                  </tr>
                </thead>
                <tbody id="current-players-tbody">
                </tbody>
              </table>
            </div>
          </div>
          <div class="panel-card">
            <h2 class="panel-heading">Banlist</h2>
            <p class="map-hint">Players whose IP matches an entry here are kicked. Optionally add a comment (e.g. reason); it is shown in the console when they are kicked.</p>
            <p class="form-notice form-notice-info">The comment is sent in-game via <code>asay</code> (max 21 chars so it fits with player name).</p>
            <div class="form-row form-row-with-button">
              <label for="ban-list-add-ip">Add entry</label>
              <div class="input-with-button input-row-two">
                <input type="text" class="input" id="ban-list-add-ip" placeholder="IP e.g. 192.168.1.1" aria-label="Ban list IP">
                <span class="input-with-counter">
                  <input type="text" class="input" id="ban-list-add-comment" placeholder="Reason (optional)" aria-label="Ban reason" maxlength="21">
                  <span class="char-counter" id="ban-list-add-comment-counter" aria-live="polite">0/21</span>
                </span>
                <button type="button" class="btn btn-sm" id="ban-list-add">Add</button>
              </div>
            </div>
            <ul class="map-list list-single" id="ban-list" role="listbox" aria-label="Banlist"></ul>
            <div class="list-actions-inline">
              <button type="button" class="btn btn-sm" id="ban-list-remove" title="Remove selected">Remove selected</button>
            </div>
          </div>
          <div class="panel-card">
            <h2 class="panel-heading">Whitelist</h2>
            <p class="form-row form-row-full">
              <label class="checkbox-label">
                <input type="checkbox" id="enable-whitelist"> Only allow whitelisted players (kick everyone else when enabled)
              </label>
            </p>
            <p class="map-hint">When enabled, only players whose IP is in the list below may stay. Add IP and optional comment.</p>
            <div class="form-row form-row-with-button">
              <label for="whitelist-add-ip">Add entry</label>
              <div class="input-with-button input-row-two">
                <input type="text" class="input" id="whitelist-add-ip" placeholder="IP e.g. 192.168.1.1" aria-label="Whitelist IP">
                <input type="text" class="input" id="whitelist-add-comment" placeholder="Comment (optional)" aria-label="Whitelist comment">
                <button type="button" class="btn btn-sm" id="whitelist-add">Add</button>
              </div>
            </div>
            <ul class="map-list list-single" id="whitelist-list" role="listbox" aria-label="Whitelist"></ul>
            <div class="list-actions-inline">
              <button type="button" class="btn btn-sm" id="whitelist-remove" title="Remove selected">Remove selected</button>
            </div>
          </div>
        </section>

        <section class="tab-panel hidden" id="panel-logs" role="tabpanel">
          <div class="panel-card">
            <h2 class="panel-heading">Logs</h2>
            <p class="map-hint">Daemon and Spectre events. Open in file explorer or refresh below.</p>
            <div class="form-row form-row-full">
              <div class="log-actions">
                <button type="button" class="btn btn-sm" id="logs-refresh" title="Reload log content">Refresh</button>
                <button type="button" class="btn btn-sm" id="logs-open-folder" title="Open log file in file explorer">Open log file</button>
              </div>
            </div>
            <div class="log-content-wrap">
              <pre class="log-content" id="log-content" aria-label="Log file content"></pre>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <dialog id="edit-server-dialog" class="edit-server-dialog" aria-label="Edit Server">
    <form method="dialog">
      <h3 class="dialog-title">Edit Server</h3>
      <div class="form-row">
        <label for="edit-server-name">Name</label>
        <input type="text" class="input" id="edit-server-name" placeholder="Server name" aria-label="Server name">
      </div>
      <div class="form-row">
        <label for="edit-server-port">Port</label>
        <input type="number" class="input input-num" id="edit-server-port" min="1" max="65535" value="22000" aria-label="Server port">
      </div>
      <div class="form-row">
        <label for="edit-server-hd2ds-path">HD2DS.exe location</label>
        <div class="input-with-icon">
          <input type="text" class="input" id="edit-server-hd2ds-path" placeholder="Path to HD2DS.exe" aria-label="HD2DS.exe location">
          <button type="button" class="btn btn-icon" id="edit-server-clear-hd2ds" title="Clear HD2DS.exe path">
            <span class="btn-icon-label">Clear</span>
          </button>
        </div>
      </div>
      <div class="form-row">
        <label for="edit-server-sabre-path">HD2DS_SabreSquadron.exe location</label>
        <div class="input-with-icon">
          <input type="text" class="input" id="edit-server-sabre-path" placeholder="Path to HD2DS_SabreSquadron.exe" aria-label="HD2DS_SabreSquadron.exe location">
          <button type="button" class="btn btn-icon" id="edit-server-clear-sabre" title="Clear HD2DS_SabreSquadron.exe path">
            <span class="btn-icon-label">Clear</span>
          </button>
        </div>
      </div>
      <div class="form-row" id="edit-server-duplicate-warning" style="display: none;">
        <p class="form-notice form-notice-warning" role="alert"></p>
      </div>
      <div class="form-row" id="edit-server-validation" style="display: none;">
        <p class="form-notice form-notice-warning" role="alert"></p>
      </div>
      <div class="dialog-actions">
        <button type="submit" class="btn btn-primary" id="edit-server-save">Save</button>
        <button type="button" class="btn btn-sm" id="edit-server-cancel">Cancel</button>
      </div>
    </form>
  </dialog>

  <script src="js/app.js"></script>
</body>
</html>
